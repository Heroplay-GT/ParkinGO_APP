<ion-content class="index-page" fullscreen="true">
  <div class="bg-gradient">
    <div class="brand">
      <div class="logo">
        <ion-icon name="clipboard-outline" style="color:#00ffc6; font-size:42px;"></ion-icon>
      </div>
      <h1>Your Reservations</h1>
      <p>View and manage your active bookings</p>
    </div>

    <button class="floating-refresh" (click)="refreshList()">
      <ion-icon name="refresh-outline"></ion-icon>
    </button>

    <!-- If user has no reservations -->
    <div *ngIf="!reservations || reservations.length === 0" class="empty-state">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <p>No reservations found</p>
    </div>

    <!-- Reservations list -->
    <div class="reservations-list" *ngIf="reservations && reservations.length > 0">
      <ion-card *ngFor="let res of reservations" class="reservation-card">
        <div class="card-icon">
          <ion-icon [name]="getVehicleIcon(res.vehicleType)" class="vehicle-icon"></ion-icon>
        </div>

        <div class="card-details">
          <h2>{{ res.plate }}</h2>
          <p><strong>Model:</strong> {{ res.model }}</p>
          <p><strong>Space:</strong> {{ res.space }}</p>
          <p><strong>Price:</strong> {{ res.pricePerHour | currency:'COP' }}</p>
          <p><strong>Status:</strong>
            <span [ngClass]="res.status.toLowerCase()">{{ res.status | titlecase }}</span>
          </p>

          <!-- Actions -->
          <div class="card-actions">
            <ion-button color="primary" fill="outline" expand="block" size="small" (click)="openQR(res)"
              [disabled]="res.status === 'cancelled' || res.status === 'expired'">
              <ion-icon name="qr-code-outline"></ion-icon>
              &nbsp; Show QR
            </ion-button>

            <ion-button color="danger" fill="solid" expand="block" size="small" (click)="cancelReservation(res.id)"
              [disabled]="res.status === 'cancelled' || res.status === 'expired' || res.status === 'active' || res.status === 'finalizado'">
              <ion-icon name="trash-outline"></ion-icon>
              &nbsp; Cancel
            </ion-button>
          </div>
        </div>
      </ion-card>
    </div>
  </div>

  <!-- Modal QR -->
  <ion-modal [isOpen]="showQRModal" (didDismiss)="closeQR()">
    <ng-template>
      <ion-header translucent>
        <ion-toolbar color="primary">
          <ion-title>Reservation QR</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeQR()">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding qr-modal-content">
        <div *ngIf="selectedQR" class="qr-container">
          <img [src]="selectedQR" alt="QR Code" />
          <p class="qr-info">Show this QR at the parking entrance.</p>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <app-submenu (navigate)="go($event)"></app-submenu>
</ion-content>
